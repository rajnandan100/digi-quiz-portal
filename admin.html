<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - Digi Quiz Portal</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- SweetAlert2 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f8fafc;
        }
        
        .sidebar {
            min-height: 100vh;
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            border-radius: 10px;
            margin: 5px 15px;
            transition: all 0.3s ease;
        }
        
        .sidebar .nav-link:hover,
        .sidebar .nav-link.active {
            background: rgba(255,255,255,0.2);
            color: white;
            transform: translateX(5px);
        }
        
        .main-content {
            min-height: 100vh;
            padding: 0;
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 1rem 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: none;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .form-control, .form-select {
            border-radius: 10px;
            border: 2px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: #dc3545;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }
        
        .btn {
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .quiz-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border: none;
            transition: all 0.3s ease;
        }
        
        .quiz-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .badge {
            border-radius: 8px;
            font-weight: 500;
        }
        
        .table {
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .login-card {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <!-- Admin Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-card">
            <div class="text-center mb-4">
                <i class="fas fa-shield-alt fa-4x text-danger mb-3"></i>
                <h3 class="fw-bold text-danger">Admin Access</h3>
                <p class="text-muted">Enter password to access admin panel</p>
            </div>
            <form id="adminLoginForm">
                <div class="mb-3">
                    <label class="form-label fw-semibold">
                        <i class="fas fa-key me-2 text-danger"></i>Admin Password
                    </label>
                    <input type="password" class="form-control form-control-lg" id="adminPassword" 
                           placeholder="Enter admin password" required autocomplete="off">
                </div>
                <button type="submit" class="btn btn-danger w-100 btn-lg">
                    <i class="fas fa-sign-in-alt me-2"></i>Access Admin Panel
                </button>
                <div id="loginError" class="alert alert-danger mt-3" style="display:none;">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    Invalid password! Access denied.
                </div>
            </form>
        </div>
    </div>

    <div class="container-fluid p-0" id="adminContent" style="display:none;">
        <div class="row g-0">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar">
                <div class="p-3">
                    <div class="navbar-brand text-white mb-4">
                        <i class="fas fa-shield-alt me-2"></i>
                        Admin Panel
                    </div>
                    
                    <nav class="nav flex-column">
                        <a class="nav-link active" href="#" data-section="stats">
                            <i class="fas fa-chart-bar me-2"></i>Website Stats
                        </a>
                        <a class="nav-link" href="#" data-section="quizzes">
                            <i class="fas fa-clipboard-list me-2"></i>Manage Quizzes
                        </a>
                        <a class="nav-link" href="#" data-section="attempts">
                            <i class="fas fa-chart-line me-2"></i>View Attempts
                        </a>
                        <a class="nav-link" href="#" data-section="settings">
                            <i class="fas fa-cog me-2"></i>Settings
                        </a>
                        <hr class="text-white-50 my-3">
                        <a class="nav-link" href="index.html">
                            <i class="fas fa-home me-2"></i>Back to Portal
                        </a>
                        <a class="nav-link" href="#" onclick="adminLogout()">
                            <i class="fas fa-sign-out-alt me-2"></i>Logout
                        </a>
                    </nav>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content">
                <!-- Header -->
                <div class="header d-flex justify-content-between align-items-center">
                    <div>
                        <h4 class="mb-0 fw-bold" id="pageTitle">Admin Dashboard</h4>
                        <small class="text-muted" id="pageSubtitle">Manage your quiz portal</small>
                    </div>
                    <div class="d-flex align-items-center gap-3">
                        <div class="badge bg-success px-3 py-2">
                            <i class="fas fa-circle me-1" style="font-size: 0.6rem;"></i>
                            Online
                        </div>
                        <div class="text-muted">
                            <i class="fas fa-user-shield me-1"></i>Administrator
                        </div>
                    </div>
                </div>
                
                <!-- Content Area -->
                <div class="p-4">
                    <!-- Website Stats Section -->
                    <div id="stats" class="content-section active">
                        <div class="card quiz-card mb-4">
                            <div class="card-header bg-danger text-white">
                                <h5 class="fw-bold mb-0">Edit Website Statistics</h5>
                                <small class="opacity-75">Update the stats displayed on homepage</small>
                            </div>
                            <div class="card-body">
                                <form id="statsForm">
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">
                                                <i class="fas fa-users text-danger me-2"></i>Active Users
                                            </label>
                                            <input type="text" class="form-control" id="activeUsers" value="1000+" placeholder="e.g., 1000+">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">
                                                <i class="fas fa-clipboard-list text-success me-2"></i>Quizzes Available
                                            </label>
                                            <input type="text" class="form-control" id="quizzesAvailable" value="50+" placeholder="e.g., 50+">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">
                                                <i class="fas fa-trophy text-warning me-2"></i>Quiz Attempts
                                            </label>
                                            <input type="text" class="form-control" id="quizAttempts" value="5000+" placeholder="e.g., 5000+">
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-semibold">
                                                <i class="fas fa-star text-info me-2"></i>User Rating
                                            </label>
                                            <input type="text" class="form-control" id="userRatingInput" value="4.8/5" placeholder="e.g., 4.8/5">
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <button type="submit" class="btn btn-danger px-4">
                                            <i class="fas fa-save me-2"></i>Update Statistics
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quiz Management Section -->
                    <div id="quizzes" class="content-section">
                        <!-- Tab Navigation -->
                        <ul class="nav nav-tabs nav-fill mb-4" id="quizTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="create-tab" data-bs-toggle="tab" data-bs-target="#createQuiz" type="button">
                                    <i class="fas fa-plus-circle me-2"></i>Create Quiz
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="manage-tab" data-bs-toggle="tab" data-bs-target="#manageQuizzes" type="button">
                                    <i class="fas fa-list me-2"></i>Manage Quizzes
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="quizTabContent">
                            <!-- CREATE QUIZ TAB -->
                            <div class="tab-pane fade show active" id="createQuiz" role="tabpanel">
                                <div class="row">
                                    <div class="col-lg-8">
                                        <div class="card quiz-card mb-4">
                                            <div class="card-header bg-danger text-white py-3">
                                                <h4 class="mb-0"><i class="fas fa-plus-circle me-2"></i>Create New Quiz</h4>
                                                <small class="opacity-75">Fill the form below to create a new quiz</small>
                                            </div>
                                            <div class="card-body p-4">
                                                <form id="quizCreationForm">
                                                    <div class="row g-3 mb-3">
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">
                                                                <i class="fas fa-calendar-alt text-danger me-2"></i>Quiz Date *
                                                            </label>
                                                            <input type="date" class="form-control" id="quizDateInput" required>
                                                        </div>
                                                        <div class="col-md-6">
                                                            <label class="form-label fw-semibold">
                                                                <i class="fas fa-book text-danger me-2"></i>Subject *
                                                            </label>
                                                            <select class="form-select" id="subjectInput" required>
                                                                <option value="">Select subject...</option>
                                                                <option value="General Knowledge">General Knowledge</option>
                                                                <option value="English">English</option>
                                                                <option value="Reasoning">Reasoning</option>
                                                                <option value="Mathematics">Mathematics</option>
                                                                <option value="Current Affairs">Current Affairs</option>
                                                            </select>
                                                        </div>
                                                    </div>

                                                    <div class="mb-3">
                                                        <label class="form-label fw-semibold">
                                                            <i class="fas fa-code text-danger me-2"></i>Questions JSON *
                                                        </label>
                                                        <textarea class="form-control font-monospace" 
                                                                  id="questionsJson" 
                                                                  rows="14" 
                                                                  required 
                                                                  placeholder='Paste your questions in JSON format. Example:

[
  {
    "question": "What is the capital of India?",
    "options": ["Mumbai", "New Delhi", "Kolkata", "Chennai"],
    "correctAnswer": 1,
    "explanation": "New Delhi is the capital of India.",
    "timeAllocation": 60
  },
  {
    "question": "Who wrote Jana Gana Mana?",
    "options": ["Rabindranath Tagore", "Bankim Chandra", "Sarojini Naidu", "Subhas Bose"],
    "correctAnswer": 0,
    "explanation": "Rabindranath Tagore wrote the national anthem.",
    "timeAllocation": 60
  }
]'></textarea>
                                                        <div class="form-text">
                                                            <i class="fas fa-info-circle me-1"></i>
                                                            <strong>Format:</strong> Array of question objects with: question, options (4 items), correctAnswer (0-3), explanation, timeAllocation
                                                        </div>
                                                    </div>

                                                    <div class="card bg-light border-0 mb-3">
                                                        <div class="card-body">
                                                            <div class="row text-center">
                                                                <div class="col-md-4">
                                                                    <i class="fas fa-list-ol fa-2x text-primary mb-2"></i>
                                                                    <h4 id="questionCount" class="text-primary mb-0">0</h4>
                                                                    <small>Questions</small>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <i class="fas fa-clock fa-2x text-success mb-2"></i>
                                                                    <h4 id="totalTime" class="text-success mb-0">0 min</h4>
                                                                    <small>Duration</small>
                                                                </div>
                                                                <div class="col-md-4">
                                                                    <button type="button" class="btn btn-outline-primary" onclick="validateJSON()">
                                                                        <i class="fas fa-check me-1"></i>Validate
                                                                    </button>
                                                                    <small class="d-block mt-1 text-muted">Check format</small>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="d-flex gap-2 flex-wrap">
                                                        <button type="submit" class="btn btn-danger btn-lg px-4">
                                                            <i class="fas fa-cloud-upload-alt me-2"></i>Create Quiz
                                                        </button>
                                                        <button type="reset" class="btn btn-outline-secondary btn-lg px-4">
                                                            <i class="fas fa-redo me-2"></i>Reset
                                                        </button>
                                                        <button type="button" class="btn btn-outline-info btn-lg px-4" onclick="copyTemplate()">
                                                            <i class="fas fa-copy me-2"></i>Template
                                                        </button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="col-lg-4">
                                        <!-- Quick Guide -->
                                        <div class="card quiz-card mb-3">
                                            <div class="card-header bg-info text-white">
                                                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Quick Guide</h5>
                                            </div>
                                            <div class="card-body">
                                                <ol class="mb-0 small">
                                                    <li class="mb-2">Set quiz date</li>
                                                    <li class="mb-2">Select subject</li>
                                                    <li class="mb-2">Paste questions JSON</li>
                                                    <li class="mb-2">Validate format</li>
                                                    <li class="mb-2">Review count & duration</li>
                                                    <li>Create quiz</li>
                                                </ol>
                                                <hr>
                                                <div class="alert alert-warning mb-0 small">
                                                    <strong>Note:</strong> correctAnswer uses index:<br>
                                                    0 = First option<br>
                                                    1 = Second option<br>
                                                    2 = Third option<br>
                                                    3 = Fourth option
                                                </div>
                                            </div>
                                        </div>

                                        <!-- JSON Template -->
                                        <div class="card quiz-card">
                                            <div class="card-header bg-warning text-dark">
                                                <h5 class="mb-0"><i class="fas fa-code me-2"></i>Template</h5>
                                            </div>
                                            <div class="card-body">
                                                <button class="btn btn-warning w-100 btn-sm mb-2" onclick="copyTemplate()">
                                                    <i class="fas fa-copy me-1"></i>Copy Template
                                                </button>
                                                <button class="btn btn-outline-warning w-100 btn-sm" onclick="fillSampleData()">
                                                    <i class="fas fa-flask me-1"></i>Load Sample
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- MANAGE QUIZZES TAB -->
                            <div class="tab-pane fade" id="manageQuizzes" role="tabpanel">
                                <div class="card quiz-card">
                                    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="fas fa-list me-2"></i>All Quizzes</h5>
                                        <div>
                                            <button class="btn btn-sm btn-light" onclick="loadAllQuizzes()">
                                                <i class="fas fa-sync-alt me-1"></i>Refresh
                                            </button>
                                            <button class="btn btn-sm btn-danger ms-2" onclick="deleteAllQuizzes()">
                                                <i class="fas fa-trash me-1"></i>Delete All
                                            </button>
                                        </div>
                                    </div>
                                    <div class="card-body p-0">
                                        <div class="table-responsive">
                                            <table class="table table-hover mb-0">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th width="5%">#</th>
                                                        <th><i class="fas fa-calendar me-1"></i>Date</th>
                                                        <th><i class="fas fa-book me-1"></i>Subject</th>
                                                        <th><i class="fas fa-list-ol me-1"></i>Questions</th>
                                                        <th><i class="fas fa-clock me-1"></i>Duration</th>
                                                        <th><i class="fas fa-users me-1"></i>Attempts</th>
                                                        <th><i class="fas fa-cog me-1"></i>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="allQuizzesTable">
                                                    <tr><td colspan="7" class="text-center py-4">Loading quizzes...</td></tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- View Attempts Section -->
                    <div id="attempts" class="content-section">
                        <div class="card quiz-card">
                            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>All Quiz Attempts</h5>
                                <div>
                                    <button class="btn btn-sm btn-light" onclick="loadAllAttempts()">
                                        <i class="fas fa-sync-alt me-1"></i>Refresh
                                    </button>
                                    <button class="btn btn-sm btn-danger ms-2" onclick="deleteAllAttempts()">
                                        <i class="fas fa-trash me-1"></i>Clear All
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th width="5%">#</th>
                                                <th><i class="fas fa-user me-1"></i>Name</th>
                                                <th><i class="fas fa-envelope me-1"></i>Email</th>
                                                <th><i class="fas fa-book me-1"></i>Quiz</th>
                                                <th><i class="fas fa-award me-1"></i>Score</th>
                                                <th><i class="fas fa-percentage me-1"></i>Accuracy</th>
                                                <th><i class="fas fa-calendar me-1"></i>Date</th>
                                                <th><i class="fas fa-cog me-1"></i>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="allAttemptsTable">
                                            <tr><td colspan="8" class="text-center py-4">Loading attempts...</td></tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div id="settings" class="content-section">
                        <div class="row g-4">
                            <!-- Portal Settings -->
                            <div class="col-md-6">
                                <div class="card quiz-card">
                                    <div class="card-header bg-primary text-white">
                                        <h5 class="fw-bold mb-0"><i class="fas fa-cog me-2"></i>Portal Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="portalSettingsForm">
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Portal Name</label>
                                                <input type="text" class="form-control" value="Digi Quiz Portal">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Contact Email</label>
                                                <input type="email" class="form-control" value="support@digiquizportal.com">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Phone Number</label>
                                                <input type="tel" class="form-control" value="+91 12345 67890">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Address</label>
                                                <textarea class="form-control" rows="2">New Delhi, India</textarea>
                                            </div>
                                            <button type="submit" class="btn btn-primary">
                                                <i class="fas fa-save me-2"></i>Save Portal Settings
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Quiz Settings -->
                            <div class="col-md-6">
                                <div class="card quiz-card">
                                    <div class="card-header bg-success text-white">
                                        <h5 class="fw-bold mb-0"><i class="fas fa-clipboard-list me-2"></i>Quiz Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="quizSettingsForm">
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Default Quiz Duration (minutes)</label>
                                                <input type="number" class="form-control" value="30" min="1" max="180">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Questions Per Quiz</label>
                                                <input type="number" class="form-control" value="25" min="5" max="100">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Passing Score (%)</label>
                                                <input type="number" class="form-control" value="60" min="1" max="100">
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Time Per Question (seconds)</label>
                                                <input type="number" class="form-control" value="60" min="15" max="300">
                                            </div>
                                            <button type="submit" class="btn btn-success">
                                                <i class="fas fa-save me-2"></i>Save Quiz Settings
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Security Settings -->
                            <div class="col-md-6">
                                <div class="card quiz-card">
                                    <div class="card-header bg-warning text-dark">
                                        <h5 class="fw-bold mb-0"><i class="fas fa-key me-2"></i>Security Settings</h5>
                                    </div>
                                    <div class="card-body">
                                        <form id="changePasswordForm">
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Current Password</label>
                                                <input type="password" class="form-control" id="currentPassword" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">New Admin Password</label>
                                                <input type="password" class="form-control" id="newPassword" minlength="8" required>
                                            </div>
                                            <div class="mb-3">
                                                <label class="form-label fw-semibold">Confirm Password</label>
                                                <input type="password" class="form-control" id="confirmPassword" minlength="8" required>
                                            </div>
                                            <button type="submit" class="btn btn-warning">
                                                <i class="fas fa-lock me-2"></i>Change Password
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Data Management -->
                            <div class="col-md-6">
                                <div class="card quiz-card">
                                    <div class="card-header bg-info text-white">
                                        <h5 class="fw-bold mb-0"><i class="fas fa-database me-2"></i>Data Management</h5>
                                    </div>
                                    <div class="card-body">
                                        <button class="btn btn-info w-100 mb-2" onclick="exportAllData()">
                                            <i class="fas fa-download me-2"></i>Export All Data (JSON)
                                        </button>
                                        <button class="btn btn-success w-100 mb-2" onclick="syncWithGoogleSheets()">
                                            <i class="fas fa-sync-alt me-2"></i>Sync with Google Sheets
                                        </button>
                                        <button class="btn btn-warning w-100 mb-2" onclick="backupData()">
                                            <i class="fas fa-save me-2"></i>Create Backup
                                        </button>
                                        <button class="btn btn-secondary w-100 mb-2" onclick="importData()">
                                            <i class="fas fa-upload me-2"></i>Import Data
                                        </button>
                                        <hr>
                                        <button class="btn btn-danger w-100" onclick="clearAllData()">
                                            <i class="fas fa-trash-alt me-2"></i>Clear All Data
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Custom JS -->
    <script src="js/api.js"></script>
    
    <script>
        // Admin password - 20 character strong password
        const ADMIN_PASSWORD = 'Dq#2025@Admin$Portal!';
        
        // Admin Authentication
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const password = document.getElementById('adminPassword').value;
            
            if (password === ADMIN_PASSWORD) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                localStorage.setItem('adminAuthenticated', 'true');
                loadAdminData();
            } else {
                document.getElementById('loginError').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('loginError').style.display = 'none';
                }, 3000);
            }
        });
        
        // Check authentication on load
        window.addEventListener('DOMContentLoaded', function() {
            const authenticated = localStorage.getItem('adminAuthenticated');
            if (authenticated === 'true') {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadAdminData();
            }
        });
        
        // Admin logout
        function adminLogout() {
            localStorage.removeItem('adminAuthenticated');
            location.reload();
        }
        
        // Navigation
        document.querySelectorAll('[data-section]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Remove active class from all links
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                // Hide all sections
                document.querySelectorAll('.content-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                // Show target section
                const targetSection = this.dataset.section;
                document.getElementById(targetSection).classList.add('active');
                
                // Update page title
                updatePageTitle(targetSection);
            });
        });
        
        function updatePageTitle(section) {
            const titles = {
                stats: ['Website Statistics', 'Update homepage statistics'],
                quizzes: ['Quiz Management', 'Create and manage quizzes'],
                attempts: ['Quiz Attempts', 'View all user attempts'],
                settings: ['Settings', 'Configure portal settings']
            };
            
            const [title, subtitle] = titles[section] || ['Admin Panel', ''];
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('pageSubtitle').textContent = subtitle;
        }
        
        // Stats Form Handler
        document.getElementById('statsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const stats = {
                activeUsers: document.getElementById('activeUsers').value,
                quizzesAvailable: document.getElementById('quizzesAvailable').value,
                quizAttempts: document.getElementById('quizAttempts').value,
                userRating: document.getElementById('userRatingInput').value
            };
            
            // Save to localStorage
            localStorage.setItem('adminStats', JSON.stringify(stats));
            
            Swal.fire({
                icon: 'success',
                title: 'Success!',
                text: 'Website statistics updated successfully!'
            });
        });













// Quiz Creation Form
document.getElementById('quizCreationForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        date: document.getElementById('quizDateInput').value,
        subject: document.getElementById('subjectInput').value,
        questionsJson: document.getElementById('questionsJson').value
    };
    
    try {
        const questions = JSON.parse(formData.questionsJson);
        
        const quizData = {
            title: `${formData.subject} Quiz - ${new Date(formData.date).toLocaleDateString()}`,
            subject: formData.subject,
            scheduledDate: formData.date,
            isActive: true,
            questions: questions
        };
        
        // Save to Google Sheets instead â† THIS FIXES IT
        const result = await QuizAPI.saveQuiz(quizData);
        
        if (result.success) {
            Swal.fire({
                icon: 'success',
                title: 'Quiz Saved to Google Sheets!',
                text: `Successfully created ${questions.length} question quiz`
            });
            
            document.getElementById('quizCreationForm').reset();
            updateQuestionStats();
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Save Failed!',
                text: result.error || 'Could not save to Google Sheets'
            });
        }
        
    } catch (error) {
        Swal.fire({
            icon: 'error',
            title: 'Invalid JSON!',
            text: 'Please check your JSON format and try again.'
        });
    }
});

    















        
        // Update question statistics
        function updateQuestionStats() {
            try {
                const json = document.getElementById('questionsJson').value;
                if (!json) {
                    document.getElementById('questionCount').textContent = '0';
                    document.getElementById('totalTime').textContent = '0 min';
                    return;
                }
                
                const questions = JSON.parse(json);
                const totalTime = questions.reduce((sum, q) => sum + (q.timeAllocation || 60), 0);
                
                document.getElementById('questionCount').textContent = questions.length;
                document.getElementById('totalTime').textContent = Math.ceil(totalTime / 60) + ' min';
            } catch (error) {
                document.getElementById('questionCount').textContent = '0';
                document.getElementById('totalTime').textContent = '0 min';
            }
        }
        
        // Copy template
        function copyTemplate() {
            const template = `[
  {
    "question": "What is the capital of India?",
    "options": ["Mumbai", "New Delhi", "Kolkata", "Chennai"],
    "correctAnswer": 1,
    "explanation": "New Delhi is the capital of India.",
    "timeAllocation": 60
  },
  {
    "question": "Who wrote Jana Gana Mana?",
    "options": ["Rabindranath Tagore", "Bankim Chandra", "Sarojini Naidu", "Subhas Bose"],
    "correctAnswer": 0,
    "explanation": "Rabindranath Tagore wrote the national anthem.",
    "timeAllocation": 60
  }
]`;
            
            navigator.clipboard.writeText(template).then(() => {
                Swal.fire({
                    icon: 'success',
                    title: 'Copied!',
                    text: 'Template copied to clipboard'
                });
            });
        }
        
        // Fill sample data
        function fillSampleData() {
            document.getElementById('questionsJson').value = `[
  {
    "question": "What is the capital of India?",
    "options": ["Mumbai", "New Delhi", "Kolkata", "Chennai"],
    "correctAnswer": 1,
    "explanation": "New Delhi is the capital of India.",
    "timeAllocation": 60
  },
  {
    "question": "Who wrote Jana Gana Mana?",
    "options": ["Rabindranath Tagore", "Bankim Chandra", "Sarojini Naidu", "Subhas Bose"],
    "correctAnswer": 0,
    "explanation": "Rabindranath Tagore wrote the national anthem.",
    "timeAllocation": 60
  },
  {
    "question": "Which planet is known as the Red Planet?",
    "options": ["Venus", "Mars", "Jupiter", "Saturn"],
    "correctAnswer": 1,
    "explanation": "Mars is called the Red Planet due to iron oxide on its surface.",
    "timeAllocation": 60
  }
]`;
            updateQuestionStats();
        }
        
        // Load quiz management data
        function loadAllQuizzes() {
            const savedQuizzes = JSON.parse(localStorage.getItem('adminQuizzes') || '[]');
            const tableBody = document.getElementById('allQuizzesTable');
            
            if (savedQuizzes.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">No quizzes found</td></tr>';
                return;
            }
            
            tableBody.innerHTML = savedQuizzes.map((quiz, index) => `
                <tr>
                    <td>${index + 1}</td>
                    <td>${new Date(quiz.date).toLocaleDateString()}</td>
                    <td><span class="badge bg-primary">${quiz.subject}</span></td>
                    <td>${quiz.questions.length}</td>
                    <td>${Math.ceil(quiz.questions.reduce((sum, q) => sum + (q.timeAllocation || 60), 0) / 60)} min</td>
                    <td>0</td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteQuiz('${quiz.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `).join('');
        }
        
        // Load attempts data
        function loadAllAttempts() {
            const tableBody = document.getElementById('allAttemptsTable');
            tableBody.innerHTML = '<tr><td colspan="8" class="text-center py-4">No attempts found</td></tr>';
        }
        
        // Delete quiz
        function deleteQuiz(quizId) {
            Swal.fire({
                title: 'Delete Quiz?',
                text: 'This action cannot be undone!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Yes, delete it!'
            }).then((result) => {
                if (result.isConfirmed) {
                    const savedQuizzes = JSON.parse(localStorage.getItem('adminQuizzes') || '[]');
                    const filteredQuizzes = savedQuizzes.filter(quiz => quiz.id !== quizId);
                    localStorage.setItem('adminQuizzes', JSON.stringify(filteredQuizzes));
                    loadAllQuizzes();
                    
                    Swal.fire('Deleted!', 'Quiz has been deleted.', 'success');
                }
            });
        }
        
        // Delete all quizzes
        function deleteAllQuizzes() {
            Swal.fire({
                title: 'Delete All Quizzes?',
                text: 'This will delete ALL quizzes permanently!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                confirmButtonText: 'Yes, delete all!'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.removeItem('adminQuizzes');
                    loadAllQuizzes();
                    Swal.fire('Deleted!', 'All quizzes deleted.', 'success');
                }
            });
        }
        
        // Data management functions
        function exportAllData() {
            const data = {
                stats: JSON.parse(localStorage.getItem('adminStats') || '{}'),
                quizzes: JSON.parse(localStorage.getItem('adminQuizzes') || '[]'),
                attempts: JSON.parse(localStorage.getItem('quizAttempts') || '[]')
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'quiz-portal-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }
        
        function syncWithGoogleSheets() {
            Swal.fire('Info', 'Google Sheets sync will be implemented with API integration', 'info');
        }
        
        function backupData() {
            const backup = {
                timestamp: new Date().toISOString(),
                data: {
                    stats: JSON.parse(localStorage.getItem('adminStats') || '{}'),
                    quizzes: JSON.parse(localStorage.getItem('adminQuizzes') || '[]'),
                    attempts: JSON.parse(localStorage.getItem('quizAttempts') || '[]')
                }
            };
            
            localStorage.setItem('dataBackup_' + Date.now(), JSON.stringify(backup));
            Swal.fire('Success', 'Data backup created successfully!', 'success');
        }
        
        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.stats) localStorage.setItem('adminStats', JSON.stringify(data.stats));
                            if (data.quizzes) localStorage.setItem('adminQuizzes', JSON.stringify(data.quizzes));
                            if (data.attempts) localStorage.setItem('quizAttempts', JSON.stringify(data.attempts));
                            Swal.fire('Success', 'Data imported successfully!', 'success');
                            loadAdminData();
                        } catch (error) {
                            Swal.fire('Error', 'Invalid JSON file!', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        function clearAllData() {
            Swal.fire({
                title: 'Clear All Data?',
                text: 'This will delete ALL data permanently!',
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#dc3545',
                confirmButtonText: 'Yes, clear all!'
            }).then((result) => {
                if (result.isConfirmed) {
                    localStorage.clear();
                    localStorage.setItem('adminAuthenticated', 'true');
                    Swal.fire('Cleared!', 'All data has been cleared.', 'success');
                    loadAdminData();
                }
            });
        }
        
        // Load saved admin data
        function loadAdminData() {
            // Load saved stats
            const savedStats = localStorage.getItem('adminStats');
            if (savedStats) {
                const stats = JSON.parse(savedStats);
                document.getElementById('activeUsers').value = stats.activeUsers || '1000+';
                document.getElementById('quizzesAvailable').value = stats.quizzesAvailable || '50+';
                document.getElementById('quizAttempts').value = stats.quizAttempts || '5000+';
                document.getElementById('userRatingInput').value = stats.userRating || '4.8/5';
            }
            
            // Set today's date
            document.getElementById('quizDateInput').value = new Date().toISOString().split('T')[0];
            
            // Load quizzes and attempts
            loadAllQuizzes();
            loadAllAttempts();
        }
        
        // Form handlers
        document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const current = document.getElementById('currentPassword').value;
            const newPass = document.getElementById('newPassword').value;
            const confirm = document.getElementById('confirmPassword').value;
            
            if (current !== ADMIN_PASSWORD) {
                Swal.fire('Error', 'Current password is incorrect!', 'error');
                return;
            }
            
            if (newPass !== confirm) {
                Swal.fire('Error', 'Passwords do not match!', 'error');
                return;
            }
            
            if (newPass.length < 8) {
                Swal.fire('Error', 'Password must be at least 8 characters!', 'error');
                return;
            }
            
            Swal.fire('Info', 'Password change requires code update. Contact developer.', 'info');
        });
        
        document.getElementById('portalSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            Swal.fire('Success', 'Portal settings saved!', 'success');
        });
        
        document.getElementById('quizSettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            Swal.fire('Success', 'Quiz settings saved!', 'success');
        });
        
        // Auto-update question stats on input
        document.getElementById('questionsJson').addEventListener('input', updateQuestionStats);
    </script>
</body>
</html>
